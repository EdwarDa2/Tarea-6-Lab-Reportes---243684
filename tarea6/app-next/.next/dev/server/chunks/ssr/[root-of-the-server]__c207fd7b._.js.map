{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 20, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/lib/db.ts"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nlet connectionString = process.env.DATABASE_URL;\r\n\r\nif (!connectionString) {\r\n  connectionString = 'postgres://postgres:postgres@localhost:5432/actividad_db';\r\n}\r\n\r\n\r\n\r\nconst pool = new Pool({\r\n  connectionString,\r\n});\r\n\r\nexport const query = async (text: string, params?: any[]) => {\r\n  try {\r\n    const res = await pool.query(text, params);\r\n    return res;\r\n  } catch (error) {\r\n    console.error('‚ùå Error ejecutando query:', text);\r\n    throw error;\r\n  }\r\n};"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,IAAI,mBAAmB,QAAQ,GAAG,CAAC,YAAY;AAE/C,IAAI,CAAC,kBAAkB;IACrB,mBAAmB;AACrB;AAIA,MAAM,OAAO,IAAI,qJAAI,CAAC;IACpB;AACF;AAEO,MAAM,QAAQ,OAAO,MAAc;IACxC,IAAI;QACF,MAAM,MAAM,MAAM,KAAK,KAAK,CAAC,MAAM;QACnC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,MAAM;IACR;AACF"}},
    {"offset": {"line": 53, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/reports/5/page.tsx"],"sourcesContent":["import { query } from '../../lib/db';\r\nimport Link from 'next/link';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nconst ITEMS_PER_PAGE = 5;\r\n\r\ninterface HistorialOrden {\r\n  orden_ref: number;\r\n  cliente: string;\r\n  total: string;\r\n  created_at: Date;\r\n  ranking_gasto_cliente: number;\r\n}\r\n\r\nexport default async function Reporte5({\r\n  searchParams,\r\n}: {\r\n  searchParams: Promise<{ page?: string }>;\r\n}) {\r\n  const params = await searchParams;\r\n  const currentPage = Number(params.page) || 1;\r\n  const offset = (currentPage - 1) * ITEMS_PER_PAGE;\r\n\r\n  const countResult = await query('SELECT COUNT(*) as total FROM vw_historial_ordenes');\r\n  const totalItems = Number(countResult.rows[0]?.total || 0);\r\n  const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);\r\n\r\n  const text = `\r\n    SELECT * FROM vw_historial_ordenes \r\n    ORDER BY created_at DESC, orden_ref ASC \r\n    LIMIT $1 OFFSET $2\r\n  `;\r\n  const result = await query(text, [ITEMS_PER_PAGE, offset]);\r\n  const ordenes = result.rows as HistorialOrden[];\r\n\r\n  return (\r\n    <main>\r\n      <Link href=\"/\" style={{ color: 'blue', marginBottom: '20px', display: 'block' }}>‚Üê Volver al Dashboard</Link>\r\n      \r\n      <h1>üèÜ Reporte 5: Historial y Ranking</h1>\r\n      \r\n      <div style={{ \r\n        background: '#f0f9ff', \r\n        border: '1px solid #bae6fd', \r\n        padding: '15px', \r\n        borderRadius: '8px',\r\n        marginBottom: '20px',\r\n        display: 'inline-block'\r\n      }}>\r\n        <span style={{ display: 'block', fontSize: '0.9rem', color: '#0c4a6e' }}>Total de √ìrdenes Procesadas</span>\r\n        <strong style={{ fontSize: '1.5rem', color: '#0284c7' }}>{totalItems}</strong>\r\n      </div>\r\n\r\n      <table>\r\n        <thead>\r\n          <tr>\r\n            <th>Cliente</th>\r\n            <th>Orden #</th>\r\n            <th>Fecha</th>\r\n            <th>Total Compra</th>\r\n            <th>Ranking Cliente</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {ordenes.length > 0 ? (\r\n            ordenes.map((o, i) => (\r\n              <tr key={i}>\r\n                <td>{o.cliente}</td>\r\n                <td>#{o.orden_ref}</td>\r\n                <td>{new Date(o.created_at).toLocaleDateString()}</td>\r\n                <td>${Number(o.total).toFixed(2)}</td>\r\n                <td>\r\n                  {o.ranking_gasto_cliente === 1 ? 'ü•á Mayor Compra' : `#${o.ranking_gasto_cliente}`}\r\n                </td>\r\n              </tr>\r\n            ))\r\n          ) : (\r\n            <tr>\r\n              <td colSpan={5} style={{ textAlign: 'center', padding: '20px' }}>\r\n                No hay m√°s resultados en esta p√°gina.\r\n              </td>\r\n            </tr>\r\n          )}\r\n        </tbody>\r\n      </table>\r\n      \r\n      <div style={{ marginTop: '20px', display: 'flex', gap: '10px', alignItems: 'center', justifyContent: 'center' }}>\r\n        \r\n        {currentPage > 1 ? (\r\n          <Link href={`/reports/5?page=${currentPage - 1}`}>\r\n            <button style={btnStyle}>‚¨Ö Anterior</button>\r\n          </Link>\r\n        ) : (\r\n          <button style={{ ...btnStyle, opacity: 0.5, cursor: 'not-allowed' }} disabled>‚¨Ö Anterior</button>\r\n        )}\r\n\r\n        <span style={{ fontWeight: 'bold' }}>\r\n          P√°gina {currentPage} de {totalPages || 1}\r\n        </span>\r\n\r\n        {currentPage < totalPages ? (\r\n          <Link href={`/reports/5?page=${currentPage + 1}`}>\r\n            <button style={btnStyle}>Siguiente ‚û°</button>\r\n          </Link>\r\n        ) : (\r\n          <button style={{ ...btnStyle, opacity: 0.5, cursor: 'not-allowed' }} disabled>Siguiente ‚û°</button>\r\n        )}\r\n      </div>\r\n    </main>\r\n  );\r\n}\r\n\r\nconst btnStyle = {\r\n  padding: '8px 16px',\r\n  background: '#333',\r\n  color: 'white',\r\n  border: 'none',\r\n  borderRadius: '4px',\r\n  cursor: 'pointer'\r\n};"],"names":[],"mappings":"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"}}]
}